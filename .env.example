# =============================================================================
# Tribal EHR - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values for your environment.
# NEVER commit the .env file to version control.
# =============================================================================

# -----------------------------------------------------------------------------
# General
# -----------------------------------------------------------------------------

# Environment: development | staging | production
NODE_ENV=development

# Log level: debug | info | warn | error
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# API Server
# -----------------------------------------------------------------------------

# Port the API server listens on
API_PORT=3001

# Frontend URL (for CORS and redirects)
FRONTEND_URL=http://localhost:3000

# Frontend port (used by deploy script health checks)
FRONTEND_PORT=3000

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------

# Full connection string used by the API/Prisma
DATABASE_URL=postgresql://ehr_admin:CHANGE_ME_DB_PASSWORD@localhost:5432/tribal_ehr?schema=public

# Individual credentials used by docker-compose for the postgres container
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=ehr_admin
POSTGRES_PASSWORD=CHANGE_ME_DB_PASSWORD
POSTGRES_DB=tribal_ehr

# -----------------------------------------------------------------------------
# FHIR Server (HAPI)
# -----------------------------------------------------------------------------

# URL where the HAPI FHIR server is reachable
FHIR_SERVER_URL=http://localhost:8080/fhir

# HAPI FHIR admin credentials (if basic auth is enabled)
FHIR_ADMIN_USER=fhir_admin
FHIR_ADMIN_PASSWORD=CHANGE_ME_FHIR_PASSWORD

# -----------------------------------------------------------------------------
# Authentication / Security
# -----------------------------------------------------------------------------

# JWT signing secret (min 32 characters; use a cryptographically random string)
JWT_SECRET=CHANGE_ME_USE_A_LONG_RANDOM_STRING_AT_LEAST_32_CHARS

# JWT issuer claim
JWT_ISSUER=tribal-ehr

# JWT token expiry
JWT_ACCESS_TOKEN_EXPIRY=15m
JWT_REFRESH_TOKEN_EXPIRY=7d

# Session secret for express-session (min 32 characters)
SESSION_SECRET=CHANGE_ME_ANOTHER_LONG_RANDOM_STRING_AT_LEAST_32

# AES-256 encryption key for PHI at rest (exactly 32 bytes / 64 hex chars)
ENCRYPTION_KEY=CHANGE_ME_64_HEX_CHARACTERS_0123456789abcdef0123456789abcdef

# Bcrypt salt rounds for password hashing
BCRYPT_SALT_ROUNDS=12

# -----------------------------------------------------------------------------
# SMART on FHIR / OAuth 2.0
# -----------------------------------------------------------------------------

# OAuth client credentials for the Tribal EHR frontend app
SMART_CLIENT_ID=tribal-ehr-frontend
SMART_CLIENT_SECRET=CHANGE_ME_SMART_SECRET

# SMART scopes supported
SMART_SCOPES=launch openid fhirUser patient/*.read patient/*.write user/*.read user/*.write

# -----------------------------------------------------------------------------
# Redis (session store, caching, job queues)
# -----------------------------------------------------------------------------

REDIS_URL=redis://localhost:6379

# -----------------------------------------------------------------------------
# Email / SMTP (for notifications, password resets)
# -----------------------------------------------------------------------------

SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=noreply@tribal-ehr.org
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_FROM=Tribal EHR <noreply@tribal-ehr.org>

# -----------------------------------------------------------------------------
# CDS Hooks
# -----------------------------------------------------------------------------

# Enable/disable CDS Hooks service
CDS_HOOKS_ENABLED=true

# External CDS service URLs (comma-separated)
CDS_EXTERNAL_SERVICES=

# -----------------------------------------------------------------------------
# Bulk Export
# -----------------------------------------------------------------------------

# Enable FHIR Bulk Data Export ($export)
BULK_EXPORT_ENABLED=true

# Directory for bulk export files (inside the container)
BULK_EXPORT_DIR=/tmp/bulk-export

# -----------------------------------------------------------------------------
# Monitoring / Observability
# -----------------------------------------------------------------------------

# Sentry DSN for error tracking (leave blank to disable)
SENTRY_DSN=

# OpenTelemetry collector endpoint (leave blank to disable)
OTEL_EXPORTER_OTLP_ENDPOINT=

# -----------------------------------------------------------------------------
# File Storage
# -----------------------------------------------------------------------------

# Storage backend: local | s3
STORAGE_BACKEND=local

# Local file storage path
STORAGE_LOCAL_PATH=./data/uploads

# S3 configuration (when STORAGE_BACKEND=s3)
AWS_S3_BUCKET=
AWS_S3_REGION=us-west-2
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------

# Max API requests per window per IP
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# -----------------------------------------------------------------------------
# HL7v2 Interface Engine
# -----------------------------------------------------------------------------

# Enable HL7v2 listener
HL7_ENABLED=false
HL7_LISTEN_PORT=2575
HL7_SEND_HOST=
HL7_SEND_PORT=

# -----------------------------------------------------------------------------
# Docker / Deployment
# -----------------------------------------------------------------------------

# Docker Compose project name
COMPOSE_PROJECT_NAME=tribal-ehr

# Docker image tag for production builds
DOCKER_TAG=latest
